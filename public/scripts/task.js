// Generated by CoffeeScript 1.3.1
(function() {
  var Task;

  Task = (function() {

    Task.name = 'Task';

    function Task(id) {
      this.id = id;
      this.url = "/tasks/" + this.id;
      this.codeUrl = this.url + '/code';
      this.resourcesUrl = this.url + '/resources';
      this.detailsUrl = this.url + '/details/json';
      this.resultUrl = this.url + '/result';
      this.name = null;
      this.description = null;
      this.code = null;
      this.result = null;
      this.taskInstance = null;
      this.readyCallbacks = [];
    }

    Task.prototype.init = function() {
      var _this = this;
      $.ajax({
        url: this.detailsUrl,
        type: 'get',
        dataType: 'json',
        success: function(data, textStatus, jqXHR) {
          _this.name = data.name;
          _this.code = data.code;
          _this.description = data.description;
          _this.taskInstance = eval(_this.code);
          _this.ready();
        },
        error: function(jqXHR, textStatus, errorThrown) {}
      });
    };

    Task.prototype.ready = function() {
      var callback, _i, _len, _ref;
      _ref = this.readyCallbacks;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        callback = _ref[_i];
        callback();
      }
    };

    Task.prototype.onReady = function(callback) {
      this.readyCallbacks.push(callback);
    };

    Task.prototype.getCode = function(callback, errorCallback) {
      var _this = this;
      errorCallback = errorCallback || callback;
      $.ajax({
        url: this.codeUrl,
        type: 'get',
        success: function(data, textStatus, jqXHR) {
          _this.taskInstance = eval(data);
          callback.apply(null, arguments);
        },
        error: function(jqXHR, textStatus, errorThrown) {
          errorCallback.apply(null, arguments);
        }
      });
    };

    Task.prototype.addScript = function(placeholder) {
      var el, script;
      placeholder = placeholder || document;
      el = $(placeholder);
      script = document.createElement('script');
      script.src = this.codeUrl;
      el.each(function() {
        this.appendChild(script);
      });
      /*
      		@getCode ( data ) ->
      			#console.log 'AddScript', data
      			el = $ placeholder
      			script = $ '<script>',
      				text: 'alert("Wow!")'
      			el.append script
      			return
      */

    };

    Task.prototype.run = function() {
      this.taskInstance.run();
    };

    Task.prototype.sendResult = function() {
      var method, url;
      url = this.resultUrl;
      method = 'put';
      console.log("sending PUT " + url);
    };

    return Task;

  })();

  window.Task = Task;

}).call(this);
